!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).router5={})}(this,function(e){"use strict";var y=function(){return(y=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u={trailingSlashMode:"default",queryParamsMode:"default",strictTrailingSlash:!1,autoCleanUp:!0,allowNotFound:!1,strongMatching:!0,rewritePathOnMatch:!0,caseSensitive:!1,urlParamsEncoding:"default"};function f(r,e){var a=S(e);return Object.keys(r).filter(function(e){return void 0!==r[e]}).map(function(e){return t=r[e=e],n=a,null===t?h(e,n):"boolean"==typeof t?p(e,t,n):Array.isArray(t)?m(e,t,n):e+"="+i(t);var t,n}).filter(Boolean).join("&")}function r(e){return e.replace(t,function(e){return encodeURIComponent(e)})}function s(e,t,n){return t=q[t]||r,n?String(e).split("/").map(t).join("/"):t(String(e))}function c(e){return"("+(e?e.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~%':|=+\\*@$]+")+")"}function a(n,r){if(void 0===r&&(r=[]),L.some(function(e){var t=n.match(e.pattern);return!!t&&(r.push({type:e.name,match:t[0],val:t.slice(1,2),otherVal:t.slice(2),regex:e.regex instanceof Function?e.regex(t):e.regex}),t[0].length<n.length&&(r=a(n.substr(t[0].length),r)),!0)}))return r;throw new Error("Could not parse path '"+n+"'")}function l(e){return null!=e}function o(e){var a="";return e.reduce(function(e,t){var n,r=null!=(r=null==(r=t.parser)?void 0:r.urlParams.reduce(function(e,t){return e[t]="url",e},{}))?r:{},r=null!=(n=null==(n=t.parser)?void 0:n.queryParams.reduce(function(e,t){return e[t]="query",e},r))?n:{};return void 0!==t.name&&(e[a=a?a+"."+t.name:t.name]=r),e},{})}function T(e,c,l,f,d){for(var t=(f=void 0===f?{}:f).queryParamsMode,p=void 0===t?"default":t,h=void 0!==(t=f.strictTrailingSlash)&&t,m=void 0===(t=f.strongMatching)||t,v=void 0!==(t=f.caseSensitive)&&t,g=1===e.length&&""===e[0].name,n=function(e){var t,n,a,r,o,i=null,u=void 0,s=c;if("/"===d&&"/"===e.path&&(s="/"+c),i=(i=e.children.length?i:e.parser.test(s,{caseSensitive:v,strictTrailingSlash:h,queryParams:f.queryParams,urlParamsEncoding:f.urlParamsEncoding}))||e.parser.partialTest(s,{delimited:m,caseSensitive:v,queryParams:f.queryParams,urlParamsEncoding:f.urlParamsEncoding}))return t=e.parser.build(i,{ignoreSearch:!0,urlParamsEncoding:f.urlParamsEncoding}),h||e.children.length||(t=t.replace(/\/$/,"")),u=0===s.toLowerCase().indexOf(t.toLowerCase())?s.slice(t.length):s,h||e.children.length||(u=u.replace(/^\/\?/,"?")),s=s.replace(t,""),s=s.split("?")[1]||"",a=e.parser.queryParams,r=f.queryParams,r=S(r),o=(""===E(s)?{querystring:"",removedParams:{}}:(o=(s=s.split("&").reduce(function(e,t){var n=e[0],e=e[1],r=t.split("=")[0],r=P(r).name;return-1===a.indexOf(r)?[n.concat(t),e]:[n,e.concat(t)]},[[],[]]))[0],s=s[1],{querystring:o.join("&"),removedParams:O(s.join("&"),r)})).querystring,u=u.split("?")[0]+(o?"?"+o:""),h||g||"/"!==u||/\/$/.test(t)||(u=""),l.segments.push(e),Object.keys(i).forEach(function(e){return l.params[e]=i[e]}),g||u.length?g||"strict"===p||0!==u.indexOf("?")?(s=e.getNonAbsoluteChildren()).length?{value:T(s,u,l,f,t)}:{value:null}:(n=O(u.slice(1),f.queryParams),Object.keys(n).forEach(function(e){return l.params[e]=n[e]}),{value:l}):{value:l}},r=0,a=e;r<a.length;r++){var o=n(a[r]);if("object"==typeof o)return o.value}return null}var S=function(e){return{arrayFormat:(e=void 0===e?{}:e).arrayFormat||"none",booleanFormat:e.booleanFormat||"none",nullFormat:e.nullFormat||"default"}},i=function(e){return encodeURIComponent(e)},d=function(e){return decodeURIComponent(e)},p=function(e,t,n){return"empty-true"===n.booleanFormat&&t?e:e+"="+("unicode"===n.booleanFormat?t?"✓":"✗":t.toString())},h=function(e,t){return"hidden"===t.nullFormat?"":"string"===t.nullFormat?e+"=null":e},m=function(n,e,t){var r="index"===(t=t).arrayFormat?function(e,t){return e+"["+t+"]"}:"brackets"===t.arrayFormat?function(e){return e+"[]"}:function(e){return e};return e.map(function(e,t){return r(n,t)+"="+i(e)}).join("&")},E=function(e){var t=e.indexOf("?");return-1===t?e:e.slice(t+1)},P=function(e){var t=e.indexOf("["),n=-1!==t;return{hasBrackets:n,name:n?e.slice(0,t):e}},O=function(e,t){var o=S(t);return E(e).split("&").reduce(function(e,t){var t=t.split("="),n=t[0],t=t[1],n=P(n),r=n.hasBrackets,n=n.name,a=e[n],t=function(e,t){if(void 0===e)return"empty-true"===t.booleanFormat||null;if("string"===t.booleanFormat){if("true"===e)return!0;if("false"===e)return!1}if("unicode"===t.booleanFormat){if("✓"===d(e))return!0;if("✗"===d(e))return!1}return"string"===t.nullFormat&&"null"===e?null:d(e)}(t,o);return e[n]=void 0===a?r?[t]:t:(Array.isArray(a)?a:[a]).concat(t),e},{})},t=/[^!$'()*+,;|:]/g,q={default:r,uri:encodeURI,uriComponent:encodeURIComponent,none:function(e){return e},legacy:encodeURI},F={default:decodeURIComponent,uri:decodeURI,uriComponent:decodeURIComponent,none:function(e){return e},legacy:decodeURIComponent},L=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(c(e[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^?]*)/},{name:"url-parameter-matrix",pattern:/^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(";"+e[1]+"="+c(e[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function(e){return new RegExp("\\"+e[0])}},{name:"sub-delimiter",pattern:/^(!|&|-|_|\.|;)/,regex:function(e){return new RegExp(e[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+)/,regex:function(e){return new RegExp(e[0])}}],M={urlParamsEncoding:"default"},v=function(){function n(e,t){if(!e)throw new Error("Missing path in Path constructor");this.path=e,this.options=y(y({},M),t),this.tokens=a(e),this.hasUrlParams=0<this.tokens.filter(function(e){return/^url-parameter/.test(e.type)}).length,this.hasSpatParam=0<this.tokens.filter(function(e){return/splat$/.test(e.type)}).length,this.hasMatrixParams=0<this.tokens.filter(function(e){return/matrix$/.test(e.type)}).length,this.hasQueryParams=0<this.tokens.filter(function(e){return/^query-parameter/.test(e.type)}).length,this.spatParams=this.getParams("url-parameter-splat"),this.urlParams=this.getParams(/^url-parameter/),this.queryParams=this.getParams("query-parameter"),this.params=this.urlParams.concat(this.queryParams),this.source=this.tokens.filter(function(e){return void 0!==e.regex}).map(function(e){return e.regex.source}).join("")}return n.createPath=function(e,t){return new n(e,t)},n.prototype.isQueryParam=function(e){return-1!==this.queryParams.indexOf(e)},n.prototype.isSpatParam=function(e){return-1!==this.spatParams.indexOf(e)},n.prototype.test=function(e,t){var n,r=this,t=y(y({caseSensitive:!1,strictTrailingSlash:!1},this.options),t),a=(a=this.source,t.strictTrailingSlash||"\\/"===a?a:a.replace(/\\\/$/,"")+"(?:\\/)?"),o=this.urlTest(e,a+(this.hasQueryParams?"(\\?.*$|$)":"$"),t.caseSensitive,t.urlParamsEncoding);return o&&this.hasQueryParams?(n=O(e,t.queryParams),0===Object.keys(n).filter(function(e){return!r.isQueryParam(e)}).length?(Object.keys(n).forEach(function(e){return o[e]=n[e]}),o):null):o},n.prototype.partialTest=function(e,t){var a,n=this,t=y(y({caseSensitive:!1,delimited:!0},this.options),t),r=(r=this.source,!t.delimited||/(\/)$/.test(r)?r:r+"(\\/|\\?|\\.|;|$)"),o=this.urlTest(e,r,t.caseSensitive,t.urlParamsEncoding);return o&&this.hasQueryParams&&(a=O(e,t.queryParams),Object.keys(a).filter(function(e){return n.isQueryParam(e)}).forEach(function(e){return t=o,void 0===(n=a[e=e])&&(n=""),r=t[e],t[e]=void 0===r?n:Array.isArray(r)?r.concat(n):[r,n],t;var t,n,r})),o},n.prototype.build=function(a,e){var o=this,i=(void 0===a&&(a={}),y(y({ignoreConstraints:!1,ignoreSearch:!1,queryParams:{}},this.options),e)),t=Object.keys(a).filter(function(e){return!o.isQueryParam(e)}).reduce(function(e,t){var n,r;return l(a[t])&&(n=a[t],r=o.isSpatParam(t),"boolean"==typeof n?e[t]=n:Array.isArray(n)?e[t]=n.map(function(e){return s(e,i.urlParamsEncoding,r)}):e[t]=s(n,i.urlParamsEncoding,r)),e},{});if(this.urlParams.some(function(e){return!l(a[e])}))throw e=this.urlParams.filter(function(e){return!l(a[e])}),new Error("Cannot build path: '"+this.path+"' requires missing parameters { "+e.join(", ")+" }");if(!i.ignoreConstraints&&!this.tokens.filter(function(e){return/^url-parameter/.test(e.type)&&!/-splat$/.test(e.type)}).every(function(e){return new RegExp("^"+c(e.otherVal[0])+"$").test(t[e.val])}))throw new Error("Some parameters of '"+this.path+"' are of invalid format");var n,e=this.tokens.filter(function(e){return!1===/^query-parameter/.test(e.type)}).map(function(e){return"url-parameter-matrix"===e.type?";"+e.val+"="+t[e.val[0]]:/^url-parameter/.test(e.type)?t[e.val[0]]:e.match}).join("");return!i.ignoreSearch&&(n=this.queryParams.filter(function(e){return-1!==Object.keys(a).indexOf(e)}).reduce(function(e,t){return e[t]=a[t],e},{}),n=f(n,i.queryParams))?e+"?"+n:e},n.prototype.getParams=function(t){var e=t instanceof RegExp?function(e){return t.test(e.type)}:function(e){return e.type===t};return this.tokens.filter(e).map(function(e){return e.val[0]})},n.prototype.urlTest=function(e,t,n,r){var a=this,t=new RegExp("^"+t,n?"":"i"),n=e.match(t);return n?this.urlParams.length?n.slice(1,this.urlParams.length+1).reduce(function(e,t,n){return e[a.urlParams[n]]=(F[r]||decodeURIComponent)(t),e},{}):{}:null},n}();function $(i){return function(e,t){var n,r,a=e.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1"),o=t.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1");return"/"===a?1:"/"===o?-1:null!=(n=e.parser)&&n.hasSpatParam?1:null!=(n=t.parser)&&n.hasSpatParam?-1:(n=(a.match(/\//g)||[]).length)<(r=(o.match(/\//g)||[]).length)?1:r<n||(r=null!=(n=null==(r=e.parser)?void 0:r.urlParams.length)?n:0)<(n=null!=(n=null==(n=t.parser)?void 0:n.urlParams.length)?n:0)?-1:n<r||(n=(a.split("/").slice(-1)[0]||"").length)<(r=(o.split("/").slice(-1)[0]||"").length)?1:r<n?-1:i.indexOf(e)-i.indexOf(t)}}var g=function(){function i(e,t,n,r){return void 0===t&&(t=""),void 0===n&&(n=[]),void 0===r&&(r={}),this.name=e=void 0===e?"":e,this.absolute=/^~/.test(t),this.path=this.absolute?t.slice(1):t,this.parser=this.path?new v(this.path):null,this.children=[],this.parent=r.parent,this.checkParents(),this.add(n,r.onAdd,!r.finalSort&&!1!==r.sort),r.finalSort&&this.sortDescendants(),this}return i.prototype.getParentSegments=function(e){return void 0===e&&(e=[]),this.parent&&this.parent.parser?this.parent.getParentSegments(e.concat(this.parent)):e.reverse()},i.prototype.setParent=function(e){this.parent=e,this.checkParents()},i.prototype.setPath=function(e){this.path=e=void 0===e?"":e,this.parser=e?new v(e):null},i.prototype.add=function(e,t,n){var r=this;if(void 0===n&&(n=!0),null!=e)if(e instanceof Array)e.forEach(function(e){return r.add(e,t,n)});else{if(!(e instanceof i||e instanceof Object))throw new Error("RouteNode.add() expects routes to be an Object or an instance of RouteNode.");if(e instanceof i)e.setParent(this),this.addRouteNode(e,n);else{if(!e.name||!e.path)throw new Error("RouteNode.add() expects routes to have a name and a path defined.");var a=new i(e.name,e.path,e.children,{finalSort:!1,onAdd:t,parent:this,sort:n}),o=a.getParentSegments([a]).map(function(e){return e.name}).join(".");t&&t(y(y({},e),{name:o})),this.addRouteNode(a,n)}}return this},i.prototype.addNode=function(e,t){return this.add(new i(e,t)),this},i.prototype.getPath=function(e){var e=this.getSegmentsByName(e);return e&&(e=e)?e.map(function(e){return e.path}).join(""):null},i.prototype.getNonAbsoluteChildren=function(){return this.children.filter(function(e){return!e.absolute})},i.prototype.sortChildren=function(){var e,t;this.children.length&&(e=this.children,t=e.slice(0),e.sort($(t)))},i.prototype.sortDescendants=function(){this.sortChildren(),this.children.forEach(function(e){return e.sortDescendants()})},i.prototype.buildPath=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n={});e=this.getSegmentsByName(e);if(e){var r=t,a=n;void 0===r&&(r={});for(var t=void 0===(t=(a=void 0===a?{}:a).queryParamsMode)?"default":t,n=void 0===(n=a.trailingSlashMode)?"default":n,o=[],i=[],u=0,s=e;u<s.length;u++){var c=s[u].parser;c&&(o.push.apply(o,c.queryParams),i.push.apply(i,c.urlParams),i.push.apply(i,c.spatParams))}"loose"===t&&(t=Object.keys(r).reduce(function(e,t){return-1===o.indexOf(t)&&-1===i.indexOf(t)?e.concat(t):e},[]),o.push.apply(o,t));var t=o.reduce(function(e,t){return-1!==Object.keys(r).indexOf(t)&&(e[t]=r[t]),e},{}),t=f(t,a.queryParams),l=e=e.reduce(function(e,t){var n=null!=(n=null==(n=t.parser)?void 0:n.build(r,{ignoreSearch:!0,queryParams:a.queryParams,urlParamsEncoding:a.urlParamsEncoding}))?n:"";return t.absolute?n:e+n},"").replace(/\/\/{1,}/g,"/");return"always"===n?l=/\/$/.test(e)?e:e+"/":"never"===n&&"/"!==e&&(l=/\/$/.test(e)?e.slice(0,-1):e),l+(t?"?"+t:"")}throw new Error("[route-node][buildPath] '{routeName}' is not defined")},i.prototype.buildState=function(e,t){void 0===t&&(t={});var n=this.getSegmentsByName(e);return n&&n.length?{name:e,params:t,meta:o(n)}:null},i.prototype.matchPath=function(e,t){void 0===t&&(t={}),""!==e||t.strictTrailingSlash||(e="/");e=this.getSegmentsMatchingPath(e,t);if(!e)return null;t=e.segments;t[0].absolute&&(n=t[0].getParentSegments(),t.reverse(),t.push.apply(t,n),t.reverse());var n=t[t.length-1].findSlashChild();return n&&t.push(n),(t=e)&&t.segments&&t.segments.length?{name:t.segments.map(function(e){return e.name}).filter(function(e){return e}).join("."),params:t.params,meta:o(t.segments)}:null},i.prototype.addRouteNode=function(e,t){void 0===t&&(t=!0);var n=e.name.split(".");if(1===n.length){if(-1!==this.children.map(function(e){return e.name}).indexOf(e.name))throw new Error('Alias "'+e.name+'" is already defined in route node');if(-1!==this.children.map(function(e){return e.path}).indexOf(e.path))throw new Error('Path "'+e.path+'" is already defined in route node');this.children.push(e),t&&this.sortChildren()}else{t=this.getSegmentsByName(n.slice(0,-1).join("."));if(!t)throw new Error("Could not add route named '"+e.name+"', parent is missing.");e.name=n[n.length-1],t[t.length-1].add(e)}return this},i.prototype.checkParents=function(){if(this.absolute&&this.hasParentsParams())throw new Error("[RouteNode] A RouteNode with an abolute path cannot have parents with route parameters")},i.prototype.hasParentsParams=function(){var e;return!(!this.parent||!this.parent.parser)&&((e=this.parent.parser).hasUrlParams||e.hasSpatParam||e.hasMatrixParams||e.hasQueryParams||this.parent.hasParentsParams())},i.prototype.findAbsoluteChildren=function(){return this.children.reduce(function(e,t){return e.concat(t.absolute?t:[]).concat(t.findAbsoluteChildren())},[])},i.prototype.findSlashChild=function(){return this.getNonAbsoluteChildren().filter(function(e){return e.parser&&/^\/(\?|$)/.test(e.parser.path)})[0]},i.prototype.getSegmentsByName=function(e){var t=[],n=this.parser?[this]:this.children;return(this.parser?[""]:[]).concat(e.split(".")).every(function(e){e=function(t,e){e=e.filter(function(e){return e.name===t});return e.length?e[0]:void 0}(e,n);return!!e&&(n=e.children,t.push(e),!0)})?t:null},i.prototype.getSegmentsMatchingPath=function(e,t){var n=(this.parser?[this]:this.children).reduce(function(e,t){return e.concat(t,t.findAbsoluteChildren())},[]),n=T(n,e,{segments:[],params:{}},t);return n&&1===n.segments.length&&""===n.segments[0].name?null:n},i}(),R={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},N={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"};function z(o){var i=0,t=null;return o.getState=function(){return t},o.setState=function(e){t=e},o.makeState=function(e,t,n,r,a){return{name:e,params:y(y({},o.config.defaultParams[e]),t),path:n,meta:r?y(y({},r),{id:void 0===a?++i:a}):void 0}},o.makeNotFoundState=function(e,t){return o.makeState(N.UNKNOWN_ROUTE,{path:e},e,{options:t})},o.areStatesEqual=function(t,n,e){var r,a;return void 0===e&&(e=!0),t.name===n.name&&(r=function(e){return o.rootNode.getSegmentsByName(e).map(function(e){return e.parser.urlParams}).reduce(function(e,t){return e.concat(t)},[])},a=e?r(t.name):Object.keys(t.params),e=e?r(n.name):Object.keys(n.params),a.length===e.length)&&a.every(function(e){return t.params[e]===n.params[e]})},o.areStatesDescendants=function(t,n){return!!new RegExp("^"+t.name+"\\.(.*)$").test(n.name)&&Object.keys(t.params).every(function(e){return t.params[e]===n.params[e]})},o.forwardState=function(e,t){var n=o.config.forwardMap[e]||e;return{name:n,params:y(y(y({},o.config.defaultParams[e]),o.config.defaultParams[n]),t)}},o.buildState=function(e,t){e=o.forwardState(e,t),t=e.name,e=e.params;return o.rootNode.buildState(t,e)},o}var b={onStart:N.ROUTER_START,onStop:N.ROUTER_STOP,onTransitionSuccess:N.TRANSITION_SUCCESS,onTransitionStart:N.TRANSITION_START,onTransitionError:N.TRANSITION_ERROR,onTransitionCancel:N.TRANSITION_CANCEL};function B(r){var a=[];return r.getPlugins=function(){return a},r.usePlugin=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.map(function(e){return a.push(e),t=r.executeFactory(e),n=Object.keys(b).map(function(e){if(t[e])return r.addEventListener(b[e],t[e])}).filter(Boolean),function(){n.forEach(function(e){return e()}),t.teardown&&t.teardown()};var t,n});return function(){a=a.filter(function(e){return-1===t.indexOf(e)}),n.forEach(function(e){return e()})}},r}function Z(r){var a=[],o=[];return r.useMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.map(function(t){var n=r.executeFactory(t);return a.push(t),o.push(n),function(){a=a.filter(function(e){return e!==t}),o=o.filter(function(e){return e!==n})}});return function(){return n.forEach(function(e){return e()})}},r.clearMiddleware=function(){return a=[],o=[],r},r.getMiddlewareFactories=function(){return a},r.getMiddlewareFunctions=function(){return o},r}var n=function(e){var t;if("function"==typeof(e=e.Symbol))if(e.observable)t=e.observable;else{t="function"==typeof e.for?e.for("https://github.com/benlesh/symbol-observable"):e("https://github.com/benlesh/symbol-observable");try{e.observable=t}catch(e){}}else t="@@observable";return t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")());function Q(r){var a={};function t(e){var t="object"==typeof e,n=t?e.next.bind(e):e,e=r.addEventListener(N.TRANSITION_SUCCESS,function(e,t){n({route:e,previousRoute:t})});return t?{unsubscribe:e}:e}function e(){var e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");return t(e)}};return e[n]=function(){return this},e}return r.invokeEventListeners=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];(a[e]||[]).forEach(function(e){return e.apply(void 0,t)})},r.removeEventListener=function(e,t){a[e]=a[e].filter(function(e){return e!==t})},r.addEventListener=function(e,t){return a[e]=(a[e]||[]).concat(t),function(){return r.removeEventListener(e,t)}},r.subscribe=t,r[n]=e,r["@@observable"]=e,r}function A(e){return e.split(".").reduce(function(e,t){return e.concat(e.length?e[e.length-1]+"."+t:t)},[])}function _(e,n){return w(n)&&K(n.meta.params[e])?Object.keys(n.meta.params[e]).reduce(function(e,t){return e[t]=n.params[t],e},{}):{}}var K=function(e){return null!=e},w=function(e){return e&&e.meta&&e.meta.params};function V(o,i){var e=o.meta&&o.meta&&o.meta.options||{},u=i?A(i.name):[],s=A(o.name),t=Math.min(u.length,s.length);function n(){for(var a=0;a<t;a+=1){var e=function(){var t,n,e=u[a],r=s[a];return e!==r||(t=_(e,o),n=_(r,i),Object.keys(t).length!==Object.keys(n).length)?{value:a}:0===Object.keys(t).length?"continue":Object.keys(t).some(function(e){return n[e]!==t[e]})?{value:a}:void 0}();if("object"==typeof e)return e.value}return a}var e=i&&!e.reload&&(w(i)||w(o))?n():0,r=u.slice(e).reverse(),a=s.slice(e);return{intersection:i&&0<e?u[e-1]:"",toDeactivate:r,toActivate:a}}function C(r,e,a){function o(e,t,n,r){function a(e,t){e?r(e):t&&t!==n&&f(t)?(d(t,n)&&console.error("[router5][transition] Warning: state values (name, params, path) were changed during transition process."),r(null,p(t,n))):r(null,n)}e=e.call(null,n,s,a),u()?a(null):"boolean"==typeof e?a(e?null:t):f(e)?a(null,e):e&&"function"==typeof e.then&&e.then(function(e){e instanceof Error?a({error:e},null):a(null,e)},function(e){e instanceof Error?(console.error(e.stack||e),a(y(y({},t),{promiseError:e}),null)):a("object"==typeof e?y(y({},t),e):t,null)})}function i(e,t){var n;u()?a():e?a(e):l.length?(e="string"==typeof l[0],n=c&&e?((n={})[c]=l[0],n):{},e=e?r[l[0]]:l[0],l=l.slice(1),o(e,n,t,i)):a(null,t)}var u=e.isCancelled,t=e.toState,s=e.fromState,e=e.errorKey,c=void 0===e?void 0:e,l=Array.isArray(r)?r:Object.keys(r),f=function(e){return"object"==typeof e&&void 0!==e.name&&void 0!==e.params&&void 0!==e.path},d=function(e,t){return t.name!==e.name||t.params!==e.params||t.path!==e.path},p=function(e,t){return y(y(y({},t),e),{meta:y(y({},t.meta),e.meta)})};i(null,t)}function W(r,a,e,t,o){function n(){return u}function i(e,t){return y(y({},e),t instanceof Object?t:{error:t})}var u=!1,s=!1,c=r.getOptions(),l=r.getLifecycleFunctions(),f=l[0],d=l[1],p=r.getMiddlewareFunctions(),l=a.name===N.UNKNOWN_ROUTE,h={isCancelled:n,toState:a,fromState:e},m=V(a,e),v=m.toDeactivate,g=m.toActivate,m=!e||t.forceDeactivate?[]:function(e,t,n){C(v.filter(function(e){return f[e]}).reduce(function(e,t){return y(y({},e),((e={})[t]=f[t],e))},{}),y(y({},h),{errorKey:"segment"}),function(e){n(e?i({code:R.CANNOT_DEACTIVATE},e):null)})},e=l?[]:function(e,t,n){C(g.filter(function(e){return d[e]}).reduce(function(e,t){return y(y({},e),((e={})[t]=d[t],e))},{}),y(y({},h),{errorKey:"segment"}),function(e){n(e?i({code:R.CANNOT_ACTIVATE},e):null)})},t=p.length?function(n,e,r){return C(p,y({},h),function(e,t){r(e?i({code:R.TRANSITION_ERR},e):null,t||n)})}:[];return C([].concat(m).concat(e).concat(t),h,function(e,t){var n;s=!0,u||(!e&&c.autoCleanUp&&(n=A(a.name),Object.keys(f).forEach(function(e){-1===n.indexOf(e)&&r.clearCanDeactivate(e)})),o(e,t||a))}),function(){u||s||(u=!0,o({code:R.TRANSITION_CANCELLED},null))}}function k(){}function H(s){var o;function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],r=e[e.length-1],a="function"==typeof r?r:k,r="object"==typeof e[1]?e[1]:{},o="object"==typeof e[2]?e[2]:{};if(s.isStarted()){n=s.buildState(n,r);if(n){var i,u,r=s.makeState(n.name,n.params,s.buildPath(n.name,n.params),{params:n.meta,options:o});if(!(!!s.getState()&&s.areStatesEqual(s.getState(),r,!1))||o.reload||o.force)return u=s.getState(),o.skipTransition?(a(null,r),k):s.transitionToState(r,u,o,function(e,t){var n;e?e.redirect?c((n=e.redirect).name,n.params,y(y({},o),{force:!0,redirected:!0}),a):a(e):(s.invokeEventListeners(N.TRANSITION_SUCCESS,t,u,o),a(null,t))});i={code:R.SAME_STATES},a(i),s.invokeEventListeners(N.TRANSITION_ERROR,r,s.getState(),i)}else i={code:R.ROUTE_NOT_FOUND},a(i),s.invokeEventListeners(N.TRANSITION_ERROR,null,s.getState(),i)}else a({code:R.ROUTER_NOT_STARTED})}return s.navigate=c,s.navigate=c,s.navigateToDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="object"==typeof e[0]?e[0]:{},r=2===e.length?e[1]:"function"==typeof e[0]?e[0]:k,a=s.getOptions();return a.defaultRoute?c(a.defaultRoute,a.defaultParams,n,r):function(){}},s.cancel=function(){return o&&(o("navigate"),o=null),s},s.transitionToState=function(n,r,e,a){return void 0===e&&(e={}),void 0===a&&(a=k),s.cancel(),s.invokeEventListeners(N.TRANSITION_START,n,r),o=W(s,n,r,e,function(e,t){o=null,t=t||n,e?(e.code===R.TRANSITION_CANCELLED?s.invokeEventListeners(N.TRANSITION_CANCEL,n,r):s.invokeEventListeners(N.TRANSITION_ERROR,n,r,e),a(e)):(s.setState(t),a(null,t))})},s}function Y(){}function G(l){var f=!1;return l.isStarted=function(){return f},l.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=l.getOptions(),r=e[e.length-1],a="function"==typeof r?r:Y,r="function"!=typeof e[0]?e[0]:void 0;if(f)a({code:R.ROUTER_ALREADY_STARTED});else{f=!0,l.invokeEventListeners(N.ROUTER_START);var o,i,u,s,c=function(e,t,n){void 0===n&&(n=!0),e||l.invokeEventListeners(N.TRANSITION_SUCCESS,t,null,{replace:!0}),e&&n&&l.invokeEventListeners(N.TRANSITION_ERROR,t,null,e),a(e,t)};if(void 0===r&&!n.defaultRoute)return c({code:R.NO_START_PATH_OR_STATE});"string"==typeof r?o=r:"object"==typeof r&&(i=r),i?(l.setState(i),c(null,i)):(i=void 0===o?null:l.matchPath(o),u=function(){return l.navigateToDefault({replace:!0},a)},s=function(e){return l.navigate(e.name,e.params,{replace:!0,reload:!0,redirected:!0},a)},r=function(e){l.transitionToState(e,l.getState(),{},function(e,t){e?e.redirect?s(e.redirect):n.defaultRoute?u():c(e,null,!1):c(null,t)})},i?r(i):n.defaultRoute?u():n.allowNotFound?r(l.makeNotFoundState(o,{replace:!0})):c({code:R.ROUTE_NOT_FOUND,path:o},null))}return l},l.stop=function(){return f&&(l.setState(null),f=!1,l.invokeEventListeners(N.ROUTER_STOP)),l},l}function I(e){return"function"==typeof e?e:function(){return function(){return e}}}function J(n){var r={},a={},o={},i={};return n.getLifecycleFactories=function(){return[r,a]},n.getLifecycleFunctions=function(){return[o,i]},n.canDeactivate=function(e,t){t=I(t);return r[e]=t,o[e]=n.executeFactory(t),n},n.clearCanDeactivate=function(e){return r[e]=void 0,o[e]=void 0,n},n.canActivate=function(e,t){t=I(t);return a[e]=t,i[e]=n.executeFactory(t),n},n}function j(e,t,n){var a,o,i;return X((i=t=void 0===t?{}:t,function(n){var r=y(y({},u),i);return n.getOptions=function(){return r},n.setOption=function(e,t){return r[e]=t,n},n}),(o=n=void 0===n?{}:n,function(n){var r=o;return n.setDependency=function(e,t){return r[e]=t,n},n.setDependencies=function(t){return Object.keys(t).forEach(function(e){return n.setDependency(e,t[e])}),n},n.getDependencies=function(){return r},n.getInjectables=function(){return[n,n.getDependencies()]},n.executeFactory=function(e){return e.apply(void 0,n.getInjectables())},n}),Q,z,G,J,H,B,Z,(a=e=void 0===e?[]:e,function(i){i.forward=function(e,t){return i.config.forwardMap[e]=t,i};var r=a instanceof g?a:new g("","",a,{onAdd:n});function n(e){e.canActivate&&i.canActivate(e.name,e.canActivate),e.forwardTo&&i.forward(e.name,e.forwardTo),e.decodeParams&&(i.config.decoders[e.name]=e.decodeParams),e.encodeParams&&(i.config.encoders[e.name]=e.encodeParams),e.defaultParams&&(i.config.defaultParams[e.name]=e.defaultParams)}return i.rootNode=r,i.add=function(e,t){return r.add(e,n,!t),t&&r.sortDescendants(),i},i.addNode=function(e,t,n){return r.addNode(e,t),n&&i.canActivate(e,n),i},i.isActive=function(e,t,n,r){void 0===t&&(t={}),void 0===n&&(n=!1),void 0===r&&(r=!0);var a=i.getState();return!!a&&(n||a.name===e?i.areStatesEqual(i.makeState(e,t),a,r):i.areStatesDescendants(i.makeState(e,t),a))},i.buildPath=function(e,t){var n,r,a;return e===N.UNKNOWN_ROUTE?t.path:(t=y(y({},i.config.defaultParams[e]),t),n=(a=i.getOptions()).trailingSlashMode,r=a.queryParamsMode,a=a.queryParams,t=i.config.encoders[e]?i.config.encoders[e](t):t,i.rootNode.buildPath(e,t,{trailingSlashMode:n,queryParamsMode:r,queryParams:a,urlParamsEncoding:i.getOptions().urlParamsEncoding}))},i.matchPath=function(e,t){var n,r,a=i.getOptions(),o=i.rootNode.matchPath(e,a);return o?(r=o.name,n=o.params,o=o.meta,n=i.config.decoders[r]?i.config.decoders[r](n):n,n=(r=i.forwardState(r,n)).name,r=r.params,a=!1===a.rewritePathOnMatch?e:i.buildPath(n,r),i.makeState(n,r,a,{params:o,source:t})):null},i.setRootPath=function(e){i.rootNode.setPath(e)},i}))({config:{decoders:{},encoders:{},defaultParams:{},forwardMap:{}}})}function x(e){return e.split(".").reduce(function(e,t){return e.concat(e.length?e[e.length-1]+"."+t:t)},[])}function U(e,n){return D(n)&&ee(n.meta.params[e])?Object.keys(n.meta.params[e]).reduce(function(e,t){return e[t]=n.params[t],e},{}):{}}var X=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return t.reduce(function(e,t){return t(e)},e)}},ee=function(e){return null!=e},D=function(e){return e&&e.meta&&e.meta.params};e.RouteNode=g,e.cloneRouter=function(e,t){var n=j(e.rootNode,e.getOptions(),t);n.useMiddleware.apply(n,e.getMiddlewareFactories()),n.usePlugin.apply(n,e.getPlugins()),n.config=e.config;var r=(t=e.getLifecycleFactories())[0],a=t[1];return Object.keys(r).forEach(function(e){return n.canDeactivate(e,r[e])}),Object.keys(a).forEach(function(e){return n.canActivate(e,a[e])}),n},e.constants=N,e.createRouter=j,e.default=j,e.errorCodes=R,e.transitionPath=function(o,i){var e=o.meta&&o.meta&&o.meta.options||{},u=i?x(i.name):[],s=x(o.name),t=Math.min(u.length,s.length);function n(){for(var a=0;a<t;a+=1){var e=function(){var t,n,e=u[a],r=s[a];return e!==r||(t=U(e,o),n=U(r,i),Object.keys(t).length!==Object.keys(n).length)?{value:a}:0===Object.keys(t).length?"continue":Object.keys(t).some(function(e){return n[e]!==t[e]})?{value:a}:void 0}();if("object"==typeof e)return e.value}return a}var e=i&&!e.reload&&(D(i)||D(o))?n():0,r=u.slice(e).reverse(),a=s.slice(e);return{intersection:i&&0<e?u[e-1]:"",toDeactivate:r,toActivate:a}},Object.defineProperty(e,"__esModule",{value:!0})});
